<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Data Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .banner {
            width: 100%;
            height: 300px;
            background: url('/mnt/data/Cosmos.jpeg') no-repeat center center/cover;
            border-radius: 8px 8px 0 0;
        }
        h1 {
            text-align: center;
            color: #003366;
            margin-top: 20px;
        }
        h2, h3 {
            text-align: center;
            color: #005b99;
        }
        .section {
            margin-bottom: 40px;
        }
        .section img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .card {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            background-color: #e6f2ff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-10px);
        }
        @media (max-width: 600px) {
            .grid {
                flex-direction: column;
            }
        }
        .update-time {
            font-size: 0.8em;
            color: #666;
            text-align: right;
        }
        .gif-grid img {
            max-width: 100%;
            border-radius: 8px;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        .card img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
            border-radius: 8px;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .photo-category {
            margin-bottom: 30px;
        }
        .photo-category h2 {
            margin: 0 0 10px 0;
        }
        .photos {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .photo {
            text-align: center;
            margin-bottom: 10px;
        }
        .photos img {
            max-width: 350px;
            height: auto;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .grid-item img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container" style="text-align: center;">
        <h1>NASA Data Dashboard</h1>
        <p>I have a keen interest in checking NASA's latest news, photos, and updates, which typically requires visiting multiple websites. To streamline this process, I've developed a static website that consolidates all the latest information into one place.</p>
        <p>Delve into NASA's freshest news, photos, and updatesâ€”all in one convenient hub. No more hopping between websites; everything you seek, unified right here.</p>
        <p>If you'd like to contribute or discuss anything related, please feel free to make a GitHub pull request or contact me at myringole@gmail.com.</p> 
        <p>Thank you for visiting!</p>
        <hr>

        <div class="section" id="apod-section">
            <h2>Astronomy Picture of the Day</h2>
            <img id="apod-image" src="" alt="APOD Image">
            <h3 id="apod-title"></h3>
            <p id="apod-description"></p>
            <p class="update-time" id="apod-updated"></p>
        </div>

        <div class="section" id="neows-section">
            <h2>Near Earth Objects Approach Date</h2>
            <div class="grid" id="neows-grid"></div>
            <p class="update-time" id="neows-updated"></p>
        </div>
        <div class="container">
        <h1>Where the ISS at?</h1>
        <div class="section" id="iss-position-section">
            <h2>Current Position of the ISS</h2>
            <div id="iss-position" class="card">
                <p>Loading ISS position...</p>
            </div>
        </div>
        <div class="section" id="iss-tle-section">
            <h2>Current TLE Data of the ISS</h2>
            <div id="iss-tle" class="card">
                <p>Loading TLE data...</p>
            </div>
        </div>
        <div class="section" id="timezone-section">
            <h2>Timezone Information</h2>
            <div id="timezone-info" class="card">
                <p>Loading timezone information...</p>
            </div>
        </div>

        <div class="section" id="people-section">
            <h2>People Currently in Space</h2>
            <div id="people-info">
                <p>Loading people in space...</p>
            </div>
        </div>

        <div class="grid" id="spacecraft-section" style="text-align: center;">
            <h2>Spacecraft Docked at the ISS ðŸš€ last 6 Missions</h2>
            <div id="spacecraftList" class="grid-container">
                <p>Loading spacecraft data...</p>
            </div>
        </div>
        

        <div class="section" id="donki-section">
            <h2>Space Weather Notifications Of 5 Upcoming Days</h2>
            <div id="donki-grid"></div>
            <p class="update-time" id="donki-updated"></p>
        </div>

        <div class="section" id="earth-section">
            <h2>Earth Observation Data</h2>
            <div id="earth-data"></div>
            <p class="update-time" id="earth-updated"></p>
        </div>

        <div class="section" id="eonet-section">
            <h2>Earth Observatory Natural Event Tracker</h2>
            <div id="eonet-data"></div>
            <p class="update-time" id="eonet-updated"></p>
        </div>

        <div class="section" id="epic-section">
            <h2>EPIC Images</h2>
            <div class="grid" id="epic-grid"></div>
            <p class="update-time" id="epic-updated"></p>
        </div>

        <div class="section" id="exoplanet-section">
            <h2>Exoplanets</h2>
            <div id="exoplanet-data"></div>
            <p class="update-time" id="exoplanet-updated"></p>
        </div>

        <div class="section" id="insight-section">
            <h2>Mars Weather</h2>
            <div id="insight-data"></div>
            <p class="update-time" id="insight-updated"></p>
        </div>

        <h2>Latest Mars Rover Photos</h2>
        <div class="grid" id="mars-rover-grid"></div>
        <div id="photoContainer">
            <!-- Photos will be displayed here -->
        </div>

        <div class="section" id="image-library-section">
            <h2>NASA Image and Video Library Latest 6 Images</h2>
            <div id="image-library-data"></div>
            <p class="update-time" id="image-library-updated"></p>
        </div>

        <div class="section" id="techtransfer-section">
            <h2>Tech Transfer</h2>
            <div id="techtransfer-data"></div>
            <p class="update-time" id="techtransfer-updated"></p>
        </div>

        <div class="section" id="ssc-section">
            <h2>"Website building is still in progress. Integration of the following topics is pending:"</h2>
            <div id="ssc-data"></div>
            <p class="update-time" id="ssc-updated"></p>
        </div>

        <div class="section" id="ssc-section">
            <h2>Satellite Situation Center</h2>
            <div id="ssc-data"></div>
            <p class="update-time" id="ssc-updated"></p>
        </div>

        <div class="section" id="ssd-cneos-section">
            <h2>Solar System Dynamics and CNEOS</h2>
            <div id="ssd-cneos-data"></div>
            <p class="update-time" id="ssd-cneos-updated"></p>
        </div>

        <div class="section" id="techport-section">
            <h2>Techport Projects</h2>
            <div id="techport-data"></div>
            <p class="update-time" id="techport-updated"></p>
        </div>

        <div class="section" id="tle-section">
            <h2>Two Line Element Data</h2>
            <div id="tle-data"></div>
            <p class="update-time" id="tle-updated"></p>
        </div>

        <div class="section" id="trek-wmts-section">
            <h2>Vesta/Moon/Mars Trek WMTS</h2>
            <div id="trek-wmts-data"></div>
            <p class="update-time" id="trek-wmts-updated"></p>
        </div>
    </div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44c1L/s5MgtCw5X340SyjSkq2Xp8RGN4qB2FZ/nUcKS1yQ==" crossorigin=""></script>
    <!-- Luxon JS -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@2.4.0/build/global/luxon.min.js"></script>

    <script>
        const apiKey = 'QDtAe0PwIFAYWbKFrR6Dw8H6cXVbP9XckqUhc5Pe';

        // Update timestamp
        function updateTimestamp(sectionId) {
            const now = new Date();
            document.getElementById(sectionId).innerText = `Last updated: ${now.toLocaleString()}`;
        }

        // Fetch APOD data
        async function fetchAPOD() {
            const response = await fetch(`https://api.nasa.gov/planetary/apod?api_key=${apiKey}`);
            const data = await response.json();
            document.getElementById('apod-image').src = data.url;
            document.getElementById('apod-title').innerText = data.title;
            document.getElementById('apod-description').innerText = data.explanation;
            updateTimestamp('apod-updated');
        }

        // Fetch Near Earth Objects data
        async function fetchNEOWS() {
            const response = await fetch(`https://api.nasa.gov/neo/rest/v1/feed?api_key=${apiKey}`);
            const data = await response.json();
            const neowsGrid = document.getElementById('neows-grid');
            data.near_earth_objects[Object.keys(data.near_earth_objects)[0]].forEach(neo => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<h3>${neo.name}</h3><p>Close Approach Date: ${neo.close_approach_data[0].close_approach_date}</p>`;
                neowsGrid.appendChild(card);
            });
            updateTimestamp('neows-updated');
        }
        async function fetchISSData() {
            const issPositionUrl = 'https://api.wheretheiss.at/v1/satellites/25544';
            const tleUrl = 'https://api.wheretheiss.at/v1/satellites/25544/tles';
            const timezoneUrl = 'https://api.wheretheiss.at/v1/coordinates/37.795517,-122.393693';

            try {
                // Fetch ISS position
                const positionResponse = await fetch(issPositionUrl);
                if (!positionResponse.ok) {
                    throw new Error('Failed to fetch ISS position data');
                }
                const positionData = await positionResponse.json();
                document.getElementById('iss-position').innerHTML = `
                    <p><strong>Latitude:</strong> ${positionData.latitude}</p>
                    <p><strong>Longitude:</strong> ${positionData.longitude}</p>
                    <p><strong>Altitude:</strong> ${positionData.altitude} km</p>
                    <p><strong>Velocity:</strong> ${positionData.velocity} km/h</p>
                    <p><strong>Visibility:</strong> ${positionData.visibility}</p>
                `;

                // Fetch TLE data
                const tleResponse = await fetch(tleUrl);
                if (!tleResponse.ok) {
                    throw new Error('Failed to fetch TLE data');
                }
                const tleData = await tleResponse.json();
                document.getElementById('iss-tle').innerHTML = `
                    <p><strong>Name:</strong> ${tleData.name}</p>
                    <p><strong>Header:</strong> ${tleData.header}</p>
                    <p><strong>Line 1:</strong> ${tleData.line1}</p>
                    <p><strong>Line 2:</strong> ${tleData.line2}</p>
                `;

                // Fetch timezone information
                const timezoneResponse = await fetch(timezoneUrl);
                if (!timezoneResponse.ok) {
                    throw new Error('Failed to fetch timezone information');
                }
                const timezoneData = await timezoneResponse.json();
                document.getElementById('timezone-info').innerHTML = `
                    <p><strong>Latitude:</strong> ${timezoneData.latitude}</p>
                    <p><strong>Longitude:</strong> ${timezoneData.longitude}</p>
                    <p><strong>Timezone ID:</strong> ${timezoneData.timezone_id}</p>
                    <p><strong>Offset:</strong> ${timezoneData.offset} hours</p>
                    <p><strong>Country Code:</strong> ${timezoneData.country_code}</p>
                    <p><a href="${timezoneData.map_url}" target="_blank">View on Google Maps</a></p>
                `;
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('iss-position').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
                document.getElementById('iss-tle').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
                document.getElementById('timezone-info').innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            }
        }

        // Fetch ISS data on page load
        fetchISSData();

        async function fetchPeopleInSpace() {
            try {
                const response = await fetch('http://api.open-notify.org/astros.json');
                if (!response.ok) {
                    throw new Error('Failed to fetch people in space data');
                }
                const data = await response.json();
                const numberOfPeople = data.number;
                const people = data.people;

                const peopleInfo = document.getElementById('people-info');
                peopleInfo.innerHTML = `
                    <p>Number of people in space: ${numberOfPeople}</p>
                    <ul>
                        ${people.map(person => `<li>${person.name} - ${person.craft}</li>`).join('')}
                    </ul>
                `;
            } catch (error) {
                console.error('Error fetching people in space data:', error);
                const peopleInfo = document.getElementById('people-info');
                peopleInfo.innerHTML = `<p>Error fetching people in space data: ${error.message}</p>`;
            }
        }

        // Call both functions to fetch and display ISS location and people in space on page load
        fetchISSLocation();
        fetchPeopleInSpace();


        async function fetchISSDockedSpacecraft() {
            const url = 'https://corquaid.github.io/international-space-station-APIs/JSON/iss-docked-spacecraft.json';
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to fetch ISS docked spacecraft data');
                }
                const data = await response.json();

                // Sort spacecraft by docked date in descending order
                data.spacecraft.sort((a, b) => b.docked - a.docked);

                const spacecraftList = document.getElementById('spacecraftList');
                spacecraftList.innerHTML = data.spacecraft.slice(0, 9).map(spacecraft => `
                    <div class="card">
                        <h3>${spacecraft.name ? spacecraft.name : 'Unknown'}</h3>
                        <p><strong>Country:</strong> ${spacecraft.country ? spacecraft.country : 'Unknown'} (${spacecraft.flag_code ? spacecraft.flag_code : 'Unknown'})</p>
                        <p><strong>Operator:</strong> ${spacecraft.operator ? spacecraft.operator : 'Unknown'}</p>
                        <p><strong>Launch Date:</strong> ${spacecraft.launched ? new Date(spacecraft.launched * 1000).toLocaleDateString() : 'Unknown'}</p>
                        <p><strong>Docked:</strong> ${spacecraft.docked ? new Date(spacecraft.docked * 1000).toLocaleString() : 'Unknown'}</p>
                        <p><strong>Docking Port:</strong> ${spacecraft.docking_port ? spacecraft.docking_port : 'Unknown'}</p>
                        <p><strong>Launch Vehicle:</strong> ${spacecraft.launch_vehicle ? spacecraft.launch_vehicle : 'Unknown'}</p>
                        <p><strong>Mission Type:</strong> ${spacecraft.mission_type ? spacecraft.mission_type : 'Unknown'}</p>
                        ${spacecraft.crew && Array.isArray(spacecraft.crew) ? `<p><strong>Crew:</strong> ${spacecraft.crew.join(', ')}</p>` : ''}
                        <a href="${spacecraft.url ? spacecraft.url : '#'}" target="_blank">More Info</a><br>
                        <img src="${spacecraft.image ? spacecraft.image : ''}" alt="${spacecraft.name ? spacecraft.name + ' Image' : 'Spacecraft Image'}">
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error fetching ISS docked spacecraft data:', error);
                const spacecraftList = document.getElementById('spacecraftList');
                spacecraftList.innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            }
        }

        // Fetch ISS docked spacecraft data on page load
        fetchISSDockedSpacecraft();



        // Fetch DONKI data
        const retryDelay = 3000; // 3 seconds delay before retry (adjust as needed)
        let retryCount = 0;
        const maxRetries = 5; // Maximum number of retries

        async function fetchDONKI() {
            const currentDate = new Date();
            const startDate = new Date(currentDate.getTime() - 24 * 60 * 60 * 1000); // 3 days ago
            const startDateString = startDate.toISOString().split('T')[0]; // Format as yyyy-MM-dd

            const url = `https://api.nasa.gov/DONKI/notifications?startDate=${startDateString}&endDate=${currentDate.toISOString()}&type=all&api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    if (response.status === 429 && retryCount < maxRetries) {
                        retryCount++;
                        console.log(`Rate limited. Retrying after ${retryDelay / 1000} seconds...`);
                        setTimeout(fetchDONKI, retryDelay); // Retry after delay
                        return;
                    }
                    throw new Error(`Failed to fetch DONKI data. Status: ${response.status}`);
                }

                const data = await response.json();
                const donkiGrid = document.getElementById('donki-grid');
                donkiGrid.innerHTML = ''; // Clear previous content

                // Filter notifications that are within the last 3 days
                const filteredData = data.filter(notification => {
                    const messageDate = new Date(notification.messageIssueTime);
                    return messageDate >= startDate;
                });

                // Prepare HTML for all notifications
                filteredData.forEach(notification => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<h3>${notification.messageType}</h3><p>${notification.messageBody}</p>`;

                    // Check for GIF or PNG links in the message body
                    const imageLinks = extractImageLinks(notification.messageBody);
                    if (imageLinks.length > 0) {
                        imageLinks.forEach(link => {
                            const img = document.createElement('img');
                            img.src = link;
                            card.appendChild(img);
                        });
                    }

                    donkiGrid.appendChild(card);
                });

                updateTimestamp('donki-updated');
            } catch (error) {
                console.error('Error fetching DONKI data:', error);
                const donkiGrid = document.getElementById('donki-grid');
                donkiGrid.innerHTML = `<p>Error fetching DONKI data: ${error.message}</p>`;
            }
        }

        function updateTimestamp(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = new Date().toLocaleString();
            }
        }

        function extractImageLinks(messageBody) {
            const regex = /(http.*?\.(?:png|gif))/gi; // Regex to find links ending with .png or .gif
            const matches = messageBody.match(regex);
            return matches ? matches : [];
        }

        // Initial fetch
        fetchDONKI();

        // Fetch Earth data for the last 3 days
        async function fetchEarth() {
            const currentDate = new Date();
            const startDate = new Date(currentDate.getTime() - 3 * 24 * 60 * 60 * 1000); // 3 days ago
            const startDateString = startDate.toISOString().split('T')[0]; // Format as yyyy-MM-dd
            const lon = -95.33;
            const lat = 29.78;
            const dim = 0.10;
            const url = `https://api.nasa.gov/planetary/earth/assets?lon=${lon}&lat=${lat}&date=${startDateString}&&dim=${dim}&api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch Earth data. Status: ${response.status}`);
                }

                const data = await response.json();
                const imageUrl = data.url;

                const earthData = document.getElementById('earth-data');
                earthData.innerHTML = `<img src="${imageUrl}" alt="Landsat 8 Image">`;

                updateTimestamp('earth-updated');
            } catch (error) {
                console.error('Error fetching Earth data: API closed by NASA on Last Updated January 29, 2020', error);
                const earthData = document.getElementById('earth-data');
                earthData.innerHTML = `<p>Error fetching Earth data: ${error.message}</p>`;
            }
        }

        function updateTimestamp(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = new Date().toLocaleString();
            }
        }

        // Initial fetch
        fetchEarth();


        // Fetch EONET data
        async function fetchEONET() {
            const response = await fetch(`https://eonet.gsfc.nasa.gov/api/v2.1/events?api_key=${apiKey}`);
            const data = await response.json();
            
            const eonetData = document.getElementById('eonet-data');
            eonetData.innerHTML = ''; // Clear previous content

            data.events.slice(0, 10).forEach(event => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${event.title}</h3>
                    <p>${event.description}</p>
                    <p><strong>Category:</strong> ${event.categories[0].title}</p>
                    <p><strong>Date:</strong> ${new Date(event.geometries[0].date).toDateString()}</p>
                `;
                eonetData.appendChild(card);
            });
            
            updateTimestamp('eonet-updated');
        }

        async function fetchEPIC() {
            const response = await fetch(`https://api.nasa.gov/EPIC/api/natural/images?api_key=${apiKey}`);
            const data = await response.json();
            
            const epicGrid = document.getElementById('epic-grid');
            epicGrid.innerHTML = ''; // Clear previous content
            
            const epicInfo = `
                <div class="epic-info">
                    <p><strong>The Earth Polychromatic Imaging Camera (EPIC)</strong> is one million miles from the planet.</p>
                    <p>The camera is attached to NOAA's Deep Space Climate Observatory (DSCOVR) satellite. DSCOVR orbits where the matching pull of gravity from the sun and Earth allows the satellite to stay relatively stable between the two bodies.</p>
                    <p>The Earth Polychromatic Imaging Camera (EPIC) is located aboard NOAA's Deep Space Climate Observatory (DSCOVR) satellite, positioned approximately one million miles from Earth. DSCOVR orbits the L1 Lagrange point, where the gravitational forces between the Sun and Earth create a stable environment for continuous observation of our planet's sunlit side.</p>
                </div>
            `;
            
            epicGrid.insertAdjacentHTML('beforeend', epicInfo); // Add EPIC information

            // Loop through images and create cards
            data.forEach(image => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<img src="https://epic.gsfc.nasa.gov/archive/natural/${image.date.split(' ')[0].replace(/-/g, '/')}/png/${image.image}.png" alt="EPIC Image">`;
                epicGrid.appendChild(card);
            });

            updateTimestamp('epic-updated');
        }


        // Fetch Exoplanets data
        async function fetchExoplanet() {
            const response = await fetch(`https://exoplanetarchive.ipac.caltech.edu/cgi-bin/nstedAPI/nph-nstedAPI?table=exoplanets&format=json`);
            const data = await response.json();
            const exoplanetData = document.getElementById('exoplanet-data');
            data.slice(0, 10).forEach(exoplanet => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${exoplanet.pl_name}</h3><p>Discovery Method: ${exoplanet.discoverymethod}</p>`;
                exoplanetData.appendChild(div);
            });
            updateTimestamp('exoplanet-updated');
        }

        // Fetch InSight Mars Weather data
        async function fetchInSight() {
        try {
            const response = await fetch(`https://api.nasa.gov/insight_weather/?api_key=${apiKey}&feedtype=json&ver=1.0`);
            const data = await response.json();
            
            console.log('Fetched data:', data);

            // Check if data is available and not empty
            if (Object.keys(data).length === 0) {
                const insightData = document.getElementById('insight-data');
                insightData.innerHTML = '<p>No data available</p>';
                return;
            }

            // Extract the latest Sol (Martian day)
            const solKeys = Object.keys(data);
            const latestSol = solKeys[solKeys.length - 1];
            const latestSolData = data[latestSol];

            console.log('Latest Sol data:', latestSolData);

            // Check if temperature data is available
            if (!latestSolData.AT || !latestSolData.HWS || !latestSolData.PRE) {
                const insightData = document.getElementById('insight-data');
                insightData.innerHTML = '<p>Weather data incomplete or unavailable</p>';
                return;
            }

            // Display temperature, wind speed, and pressure for the latest Sol
            const insightData = document.getElementById('insight-data');
            insightData.innerHTML = `
                <h3>Sol ${latestSol}</h3>
                <p>Temperature: ${latestSolData.AT.av}Â°C</p>
                <p>Wind Speed: ${latestSolData.HWS.av} m/s</p>
                <p>Pressure: ${latestSolData.PRE.av} Pa</p>
            `;

            updateTimestamp('insight-updated');
        } catch (error) {
            console.error('Error fetching InSight data:', error);
            const insightData = document.getElementById('insight-data');
            insightData.innerHTML = `<p>Error fetching InSight data: ${error.message}</p>`;
        }
        }

        // Function to update timestamp
        function updateTimestamp(elementId) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = new Date().toLocaleString();
        }
        }

        // Initial fetch
        fetchInSight();

        // Function to fetch ISS current location and plot on map
        async function fetchISSLocation() {
            try {
                const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
                if (!response.ok) {
                    throw new Error('Failed to fetch ISS location');
                }
                const data = await response.json();

                const { latitude, longitude } = data;

                // Initialize map
                const map = L.map('map').setView([latitude, longitude], 3);

                // Add tile layer (OpenStreetMap)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                // Add ISS marker
                const issIcon = L.icon({
                    iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/International_Space_Station.svg/1024px-International_Space_Station.svg.png',
                    iconSize: [50, 32],
                    iconAnchor: [25, 16],
                });

                L.marker([latitude, longitude], { icon: issIcon }).addTo(map)
                    .bindPopup(`<b>ISS Current Location</b><br>Latitude: ${latitude}<br>Longitude: ${longitude}`)
                    .openPopup();

            } catch (error) {
                console.error('Error fetching ISS location:', error);
                // Handle error display as needed
            }
        }

        // Call fetchISSLocation function to fetch and plot ISS location on page load
        fetchISSLocation();


        

        const BASE_URL = "https://mars-photos.herokuapp.com/api/v1/rovers";
        const rovers = ["perseverance", "curiosity"];

        async function fetchData(url) {
            const response = await fetch(url);
            if (response.ok) {
                return await response.json();
            } else {
                throw new Error("Error fetching data: " + response.status + " " + response.statusText);
            }
        }

        async function displayLatestPhotos() {
            const photoContainer = document.getElementById("photoContainer");
            photoContainer.innerHTML = '';

            for (const rover of rovers) {
                const url = `${BASE_URL}/${rover}/latest_photos?api_key=${apiKey}`;
                try {
                    const data = await fetchData(url);
                    const photos = data.latest_photos.slice(0, 15); // Get the latest 24 photos
                    const categoryDiv = document.createElement("div");
                    categoryDiv.className = "photo-category";

                    const header = document.createElement("h2");
                    header.textContent = rover.charAt(0).toUpperCase() + rover.slice(1) + " Rover";
                    categoryDiv.appendChild(header);

                    const photosDiv = document.createElement("div");
                    photosDiv.className = "photos";

                    if (photos.length > 0) {
                        photos.forEach(photo => {
                            const photoDiv = document.createElement("div");
                            photoDiv.className = "photo";

                            const img = document.createElement("img");
                            img.src = photo.img_src;
                            img.alt = `Photo by ${rover} on ${photo.earth_date} using ${photo.camera.full_name}`;

                            const date = document.createElement("p");
                            date.textContent = photo.earth_date;

                            photoDiv.appendChild(img);
                            photoDiv.appendChild(date);
                            photosDiv.appendChild(photoDiv);
                        });
                    } else {
                        photosDiv.innerHTML = '<p>No photos found for this rover.</p>';
                    }

                    categoryDiv.appendChild(photosDiv);
                    photoContainer.appendChild(categoryDiv);
                } catch (error) {
                    const errorDiv = document.createElement("div");
                    errorDiv.className = "photo-category";
                    errorDiv.innerHTML = `<h2>${rover.charAt(0).toUpperCase() + rover.slice(1)} Rover</h2><p>${error.message}</p>`;
                    photoContainer.appendChild(errorDiv);
                }
            }
        }

        async function fetchMarsRover() {
            const response = await fetch(`https://api.nasa.gov/mars-photos/api/v1/rovers/curiosity/photos?sol=1000&api_key=${apiKey}`);
            const data = await response.json();
            const marsRoverGrid = document.getElementById('mars-rover-grid');
            data.photos.slice(0, 10).forEach(photo => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<img src="${photo.img_src}" alt="Mars Rover Photo"><p>${photo.earth_date}</p>`;
                marsRoverGrid.appendChild(card);
            });
            updateTimestamp('mars-rover-updated');
        }

        async function fetchImageLibrary() {
            const response = await fetch(`https://images-api.nasa.gov/search?q=moon&media_type=image`);
            const data = await response.json();
            const imageLibraryData = document.getElementById('image-library-data');
            imageLibraryData.innerHTML = ''; // Clear existing content

            const itemsToShow = 6; // Number of items to display
            const items = data.collection.items.slice(0, itemsToShow);

            // Create a grid layout
            const gridContainer = document.createElement('div');
            gridContainer.classList.add('grid-container');

            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.classList.add('grid-item');
                div.innerHTML = `
                    <h3>${item.data[0].title}</h3>
                    <img src="${item.links[0].href}" alt="${item.data[0].title}">
                `;
                gridContainer.appendChild(div);
            });

            imageLibraryData.appendChild(gridContainer);
            updateTimestamp('image-library-updated');
        }

        function updateTimestamp(elementId) {
            const element = document.getElementById(elementId);
            const now = new Date();
            element.textContent = `Last updated: ${now.toLocaleString()}`;
        }

        window.onload = () => {
            displayLatestPhotos();
            fetchMarsRover();
            fetchImageLibrary();
        };

        // Fetch Tech Transfer data
        async function fetchTechTransfer() {
            const response = await fetch(`https://api.nasa.gov/techtransfer/patent/?q=10&engine&api_key=${apiKey}`);
            const data = await response.json();
            const techTransferData = document.getElementById('techtransfer-data');
            data.results.slice(0, 10).forEach(patent => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${patent[2]}</h3><p>${patent[3]}</p>`;
                techTransferData.appendChild(div);
            });
            updateTimestamp('techtransfer-updated');
        }

        // Fetch Satellite Situation Center data
        async function fetchSSC() {
            const response = await fetch(`https://api.nasa.gov/ssc/tle/1.0?api_key=${apiKey}`);
            const data = await response.json();
            const sscData = document.getElementById('ssc-data');
            data.slice(0, 10).forEach(satellite => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${satellite.OBJECT_NAME}</h3><p>${satellite.TLE_LINE1}</p><p>${satellite.TLE_LINE2}</p>`;
                sscData.appendChild(div);
            });
            updateTimestamp('ssc-updated');
        }

        // Fetch Solar System Dynamics and CNEOS data
        async function fetchSSDCNEOS() {
            const response = await fetch(`https://ssd-api.jpl.nasa.gov/sentry.api`);
            const data = await response.json();
            const ssdCNEOSData = document.getElementById('ssd-cneos-data');
            data.data.slice(0, 10).forEach(entry => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${entry.des}</h3><p>Potential Impact Date: ${entry.ip}</p>`;
                ssdCNEOSData.appendChild(div);
            });
            updateTimestamp('ssd-cneos-updated');
        }

        // Fetch Techport projects
        async function fetchTechport() {
            const response = await fetch(`https://api.nasa.gov/techport/api/projects?api_key=${apiKey}`);
            const data = await response.json();
            const techportData = document.getElementById('techport-data');
            data.projects.slice(0, 10).forEach(project => {
                const div = document.createElement('div');
                div.innerHTML = `<h3>${project.title}</h3><p>${project.description}</p>`;
                techportData.appendChild(div);
            });
            updateTimestamp('techport-updated');
        }

        // Initial fetch calls
        fetchAPOD();
        fetchNEOWS();
        fetchDONKI();
        fetchEarth();
        fetchEONET();
        fetchEPIC();
        fetchExoplanet();
        fetchInSight();
        fetchMarsRover();
        fetchImageLibrary();
        fetchTechTransfer();
        fetchSSC();
        fetchSSDCNEOS();
        fetchTechport();
        fetchTLE();
        fetchTrekWMTS();
    </script>

    <!-- Footer -->
    <footer>
        <p>All data is fetched from NASA's open API.</p>
        <p>Thanks for visiting! Contact Email: <a href="mailto:myringole@gmail.com">myringole@gmail.com</a></p>
    </footer>
</body>
</html>